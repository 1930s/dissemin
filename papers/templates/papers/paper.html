{% extends "dissemin/details.html" %}

{% load author %}
{% load domain %}
{% load statuses %}
{% load doi %}
{% load i18n %}

{% block headTitle %}
{{ paper.title }}
{% endblock %}

{% block bodyTitle %}
<span id="paperTitle" data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}">{{ paper.title }}</span>
{% endblock %}

{% block jsScript %}
{% if request.user.is_superuser %}
$(function(){
makeTextEditable($('#paperTitle'), '/ajax/change-paper', '{{ paper.id }}', 'title');
});
{% endif %}
{% endblock %}

{% block lists %}
<p>
{% for author in paper.author_set.all %}{% if not forloop.first %},{% endif %}
{{ author | authorlink }}{% endfor %}</p>
{% for publi in paper.publication_set.all %}
<p>{{ publi | publication }}
{% if publi.doi %}
(DOI: <a href="{{ publi | doi_to_url }}">{{ publi.doi }}</a>)
{% endif %}
</p>
{% endfor %}

<p><strong>{% trans "Full text:" %}</strong>
    {% if paper.pdf_url %}<a href="{{ paper.pdf_url }}">{% trans "Available" %}</a>
    {% else %}{% trans "Unavailable" %}{% endif %}.</p>

{% if paper.publication_set.first.journal %}
<p><strong>{% trans "Publisher policy:" %}</strong> {{ paper.oa_status | explain_oa_status }}
(<a href="{% url 'publisher' paper.publication_set.first.journal.publisher.pk %}">{% trans "details" %}</a>)</p>
{% endif %}

{% for record in paper.oairecord_set.all %}
{% if forloop.first %}
    {% if record.description %}
        <p><strong>{% trans "Abstract." %}</strong> {{ record.description }}</p>
    {% endif %}
{% endif %}
{% endfor %}
{% endblock %}

{% block details %}
<span class="detailsTitle">{% trans "Available from" %}</span>
<div class="detailsContent">
{% for record in paper.sorted_oai_records %}
<p>
    {% if record.priority > 0 %}
        {{ record.source }}:
    {% else %}
        {% if record.splash_url %}
            [{{ record.splash_url |domain }}]
        {% elif record.pdf_url %}
            [{{ record.pdf_url |domain }}]
        {% endif %}
    {% endif %}
    {% if record.splash_url %}
        <a href="{{ record.splash_url }}">
     {% endif %}
     {% trans "[Web page]" %}
     {% if record.splash_url %}</a>{% endif %}
     {% if record.pdf_url %}
         <a href="{{ record.pdf_url }}">{% trans "[PDF]" %}</a>
     {% endif %}
</p>
{% endfor %}

{% trans "Publisher" as publisher %}
{% for publi in paper.publication_set.all %}
<p><a href="{{ publi | doi_to_url }}">{{ publi.publisher|default:publisher }}</a> {% trans "via DOI" %}</p>
{% endfor %}
</div>

{% if request.user.is_superuser %}
<p>Visibility: {{ paper.visibility }}</p>
{% endif %}
{% endblock %}
