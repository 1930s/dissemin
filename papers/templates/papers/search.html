{% extends "dissemin/details.html" %}

{% load staticfiles %}
{% load bootstrap_pagination %}
{% load statuses %}

{% block headTitle %}
{{ search_description }}
{% endblock %}

{% block bodyTitle %}
{{ search_description }}
{% endblock %}

{% block jsScript %}
{% if request.user.is_superuser %}
$(function(){
{% for paper in search_results %}
    makeTextEditable($('#paper-title-{{ paper.id }}'), '/ajax/change-paper', '{{ paper.id }}', 'title');
{% endfor %}
});
{% endif %}
{% endblock %}

{% block details %}
{% if researcher %}
    <span class="detailsTitle">Researcher</span>
    <div class="detailsContent">
        <p>{{ researcher }}</p>
        {% if researcher.role %}
        <p>{{ researcher.role }}</p>
        {% endif %}
        <p><a href="{% url 'department' researcher.department.id %}">{{ researcher.department }}</a></p>
        {% if researcher.homepage %}
        <p><a href="{{ researcher.homepage }}">Homepage</a></p>
        {% endif %}
        {% if request.user.is_superuser and researcher.email %}
        <p>Address: {{ researcher.email }}</p>
        {% endif %}
    </div>
{% endif %}
{% if department %}
    <span class="detailsTitle">Department</span>
    <div class="detailsContent">
        <p>{{ department }}</p>
        <p><a href="{% url 'department' department.id %}">{{ department.researcher_set.count }} members</a></p>
    </div>
{% endif %}
{% if journal %}
    <span class="detailsTitle">Journal</span>
    <div class="detailsContent">
        <p>{{ journal }}</p>
        <p>Published by <a href="{% url 'publisher' journal.publisher.id %}">{{ journal.publisher }}</a></p>
        {% if journal.issn %}
        <p>ISSN: {{ journal.issn }}</p>
        {% endif %}
        <div class="unselectedCriterion">
        <div class="pubLogo"><div class="pubLogoPic-{{ journal.publisher.oa_status }}"></div></div>
        <div class="criterionItem">{{ journal.publisher.oa_status |explain_oa_status}}</div>
        </div>
    </div>
{% endif %}

<span class="detailsTitle">Refine search</span>
<div class="detailsContent">
<p>{{ nb_results }} papers found</p>

{% if not journal %}
<span class="criterion">By publisher policy:</span>
{% for st in oa_status_choices %}
<div class="{% if st.0 == status %}selectedCriterion{% else %}unselectedCriterion{% endif %}">
    <div class="pubLogo"><div class="pubLogoPic-{{ st.0 }}"><a href="{% url 'search' %}?{{ st.2.urlencode }}" class="filldiv"></a></div></div>
    <div class="criterionItem"><a href="{% url 'search' %}?{{ st.2.urlencode }}">{{ st.1 }}</a>
        {% if st.0 == status %}
        <div class="criterionCross"><a href="{% url 'search' %}?{{ st.2.urlencode }}">x</a></div>
        {% endif %}
    </div>
</div>
{% endfor %}
{% endif %}

<span class="criterion">By full text availability:</span>
{% for st in pdf_status_choices %}
<div class="{% if st.0 == pdf %}selectedCriterion{% else %}unselectedCriterion{% endif %}">
     <div class="pubLogo"><div class="pubLogoPic-PDF-{{ st.0 }}"><a href="{% url 'search' %}?{{ st.2.urlencode }}" class="filldiv"></a></div></div>
    <div class="criterionItem"><a href="{% url 'search' %}?{{ st.2.urlencode }}">{{ st.1 }}</a>
        {% if st.0 == pdf %}
        <div class="criterionCross"><a href="{% url 'search' %}?{{ st.2.urlencode }}">x</a></div>
        {% endif %}
    </div>
</div>
{% endfor %}

{% if request.user.is_superuser %}
<span class="criterion">By visibility:</span>
{% for st in visibility_choices %}
   <div class="{% if st.0 == visibility %}selectedCriterion{% else %}unselectedCriterion{% endif %}">
     <div class="pubLogo"><div class="pubLogoPic-PDF-{{ st.0 }}"><a href="{% url 'search' %}?{{ st.2.urlencode }}" class="filldiv"></a></div></div>
    <div class="criterionItem"><a href="{% url 'search' %}?{{ st.2.urlencode }}">{{ st.1 }}</a>
        {% if st.0 == visibility %}
        <div class="criterionCross"><a href="{% url 'search' %}?{{ st.2.urlencode }}">x</a></div>
        {% endif %}
   </div>
</div>
{% endfor %}
{% endif %}

</div>
{% endblock %}

{% block lists %}
<div class="searchPages">{% bootstrap_paginate search_results range=10 %}</div>
 {% for paper in search_results %}
 {% ifchanged paper.year %}
 {% if not forloop.first %}</ul></div>{% endif %}
    <div class="ulContainer">
    <div class="listYear">{{ paper.year }}</div><ul>
 {% endifchanged %}
    <li>
        {% include "papers/publiListItem.html" with paper=paper %}
</li>    
        {% if forloop.last %}</ul></div>{% endif %}
 {% empty %}
 <p>No production found.</p>
 {% endfor %}
 {% if search_results.paginator.num_pages > 1 %}
 <div class="searchPages">{% bootstrap_paginate search_results range=10 %}</div>
 {% endif %}
{% endblock %}
